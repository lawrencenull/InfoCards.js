/********** Infocards.js by Tim Nguyen ***********/
/****** http://github.com/nt1m/InfoCards.js ******/
function InfoCard(d){var c=this;if(!d||!d.query)throw new SyntaxError("[InfoCard] Missing query parameter");if(!d.container)throw new SyntaxError("[InfoCard] Missing container parameter");this.query=d.query;this.container=d.container;this.options=d;this.apiURL="http://api.duckduckgo.com/?q="+encodeURIComponent(this.query)+"&format=json";this.getJSONData=function(b,c){var a=this.apiURL,e="jsonp_callback_"+Math.round(1E5*Math.random());window[e]=function(a){delete window[e];document.body.removeChild(d);
b(a)};var d=document.createElement("script");d.src=a+(0<=a.indexOf("?")?"&":"?")+"callback="+e;document.body.appendChild(d);d.onerror=function(){c()}};this.hasTabs=!1;this.onEmptyCallback=function(){if(d.hasOwnProperty("onEmpty"))d.onEmpty(c.container)};this.applyDomOptions=function(b,c){d.hasOwnProperty("classNames")&&d.classNames.hasOwnProperty(b)&&c.classList.add(d.classNames[b])};this.parseTopic=function(b,d){if(!b.hasOwnProperty("Topics")){var a=document.createElement("li");c.applyDomOptions("category-item",
a);d.appendChild(a);var e=document.createElement("h2");e.innerHTML=decodeURIComponent(b.FirstURL.replace("https://duckduckgo.com/","").replace(/_/g," "));a.appendChild(e);b.hasOwnProperty("Icon")&&""!=b.Icon.URL&&(e=document.createElement("img"),e.src=b.Icon.URL,a.appendChild(e));e=document.createElement("p");e.innerHTML=b.Result;a.appendChild(e);a=e.querySelector("a");e.removeChild(a)}};this.createCard=function(){c.getJSONData(function(b){c.container.classList.add("InfoCard-container");if(""==b.Heading||
""==b.Type)c.onEmptyCallback();else{c.card=document.createElement("div");c.container.appendChild(c.card);c.card.classList.add("InfoCard-card");c.applyDomOptions("card",c.card);var f=document.createElement("div");f.classList.add("InfoCard-text");c.card.appendChild(f);var a=document.createElement("h1");f.appendChild(a);a.classList.add("InfoCard-title");a.innerHTML=b.Heading;c.card.classList.add("InfoCard-type-"+b.Type.toLowerCase());switch(b.Type){case "A":if(b.Image||""!=b.Image){a=document.createElement("div");
a.classList.add("InfoCard-image-container");c.card.insertBefore(a,f);var e=document.createElement("img");e.classList.add("InfoCard-image");e.src=b.Image;e.style.width=b.ImageWidth;e.style.height=b.ImageHeight;a.appendChild(e)}b.Entity&&(a=document.createElement("p"),a.classList.add("InfoCard-entity"),a.innerHTML=b.Entity,f.appendChild(a));a=document.createElement("p");a.innerHTML=b.Abstract;a.classList.add("InfoCard-description");f.appendChild(a);if(b.hasOwnProperty("Results")&&0<b.Results.length){var l=
document.createElement("div");l.classList.add("InfoCard-links");f.appendChild(l);b.Results.forEach(function(a){var b=document.createElement("a");b.href=a.FirstURL;l.appendChild(b);var c=document.createElement("img");c.src=a.Icon.URL;c.classList.add("InfoCard-link-icon");b.appendChild(c);c=document.createElement("span");c.innerHTML=a.Text;b.appendChild(c)})}if((b.Infobox||""!=b.Infobox)&&b.Infobox.hasOwnProperty("content")){var k=document.createElement("ul");k.classList.add("InfoCard-list");c.card.appendChild(k);
b.Infobox.content.forEach(function(a){var b=document.createElement("li");k.appendChild(b);var c=document.createElement("label");c.innerHTML=a.label;b.appendChild(c);c=document.createElement("span");c.innerHTML=a.value;b.appendChild(c)})}break;case "D":if(!b.hasOwnProperty("RelatedTopics")&&""==b.RelatedTopics){c.onEmptyCallback();return}c.hasTabs=!0;var g=document.createElement("ul");g.classList.add("InfoCard-tabs");c.applyDomOptions("tabs",g);f.appendChild(g);a=document.createElement("li");a.innerHTML=
"Top";a.dataset.id="top";g.appendChild(a);var h=document.createElement("ul");h.className="InfoCard-category InfoCard-tab-content";h.dataset.id="top";f.appendChild(h);b.RelatedTopics.forEach(function(a){if(a.hasOwnProperty("Topics")){var b=document.createElement("li");b.innerHTML=a.Name;b.dataset.id=a.Name;g.appendChild(b);var e=document.createElement("sup");e.innerHTML=a.Topics.length;b.appendChild(e);var d=document.createElement("ul");d.className="InfoCard-category InfoCard-tab-content";d.dataset.id=
a.Name;f.appendChild(d);a.Topics.forEach(function(a){c.parseTopic(a,d)})}else c.parseTopic(a,h)});b=document.createElement("sup");b.innerHTML=h.querySelectorAll("li").length;a.appendChild(b);break;case "C":if(!b.hasOwnProperty("RelatedTopics")&&""==b.RelatedTopics){c.onEmptyCallback();return}break;case "E":if(""==b.Answer){c.onEmptyCallback();return}a=document.createElement("p");a.innerHTML=b.Answer;f.appendChild(a);a.querySelector("style")&&a.querySelector("style").remove();a.querySelector("script")&&
a.querySelector("script").remove();a.innerHTML=a.textContent;break;case "N":d.onError(1);return;default:d.onError(1);return}c.hasTabs&&c.initTabs();if(d.onLoad)d.onLoad(c.card)}},function(){d.onError(0)})};this.initTabs=function(){for(var b=c.container.querySelectorAll(".InfoCard-tab-content"),d=c.container.querySelectorAll(".InfoCard-tabs > li"),a=0,e=b.length;a<e;a++)b[a].style.display="none";c.container.querySelector(".InfoCard-tab-content[data-id='top']").style.display="block";c.container.querySelector(".InfoCard-tabs > li[data-id='top']").classList.add("InfoCard-selected");
a=0;for(e=d.length;a<e;a++)d[a].addEventListener("click",function(){for(var a=0,e=d.length;a<e;a++)d[a].classList.remove("InfoCard-selected");this.classList.add("InfoCard-selected");a=0;for(e=b.length;a<e;a++)b[a].style.display="none";c.container.querySelector(".InfoCard-tab-content[data-id='"+this.dataset.id+"']").style.display="block"},!1)};this.destroy=function(){c.container.innerHTML=""};this.createCard()};
