/********** Infocards.js by Tim Nguyen ***********/
/****** http://github.com/nt1m/InfoCards.js ******/
function InfoCard(a){var b=this;if(!a||!a.query)throw new SyntaxError("[InfoCard] Missing query parameter");if(!a.container)throw new SyntaxError("[InfoCard] Missing container parameter");this.query=a.query,this.container=a.container,this.options=a,this.apiURL="http://api.duckduckgo.com/?q="+encodeURIComponent(this.query)+"&format=json",this.getJSONData=function(a,b){var c=this.apiURL,d="jsonp_callback_"+Math.round(1e5*Math.random());window[d]=function(b){delete window[d],document.body.removeChild(e),a(b)};var e=document.createElement("script");e.src=c+(c.indexOf("?")>=0?"&":"?")+"callback="+d,document.body.appendChild(e),e.onerror=function(){b()}},this.hasTabs=!1,this.onEmptyCallback=function(){a.hasOwnProperty("onEmpty")&&a.onEmpty(b.container)},this.applyDomOptions=function(b,c){a.hasOwnProperty("classNames")&&a.classNames.hasOwnProperty(b)&&c.classList.add(a.classNames[b])},this.parseTopic=function(a,c){if(!a.hasOwnProperty("Topics")){var d=document.createElement("li");b.applyDomOptions("category-item",d),c.appendChild(d);var e=document.createElement("h2");if(e.innerHTML=decodeURIComponent(a.FirstURL.replace("https://duckduckgo.com/","").replace(/_/g," ")),d.appendChild(e),a.hasOwnProperty("Icon")&&""!=a.Icon.URL){var f=document.createElement("img");f.src=a.Icon.URL,d.appendChild(f)}var g=document.createElement("p");g.innerHTML=a.Result,d.appendChild(g);var h=g.querySelector("a");g.removeChild(h)}},this.matchesSelector=function(a,b){var c=a.matches||a.webkitMatchesSelector||a.mozMatchesSelector||a.msMatchesSelector;return c.call(a,b)},this.enableHorizontalScrolling=function(b){a.horizontalScrolling&&("string"!=typeof a.horizontalScrolling||this.matchesSelector(b,a.horizontalScrolling))&&b.addEventListener("wheel",function(a){b.scrollLeft+=5*a.deltaY,a.preventDefault()})},this.createCard=function(){b.getJSONData(function(c){if(b.container.classList.add("InfoCard-container"),"E"!==c.Type&&(""==c.Heading||""==c.Type))return void b.onEmptyCallback();b.card=document.createElement("div"),b.container.appendChild(b.card),b.card.classList.add("InfoCard-card"),b.applyDomOptions("card",b.card);var d=document.createElement("div");d.classList.add("InfoCard-text"),b.card.appendChild(d);var e=document.createElement("h1");switch(d.appendChild(e),e.classList.add("InfoCard-title"),e.innerHTML=c.Heading,b.card.classList.add("InfoCard-type-"+c.Type.toLowerCase()),c.Type){case"A":if(c.Image||""!=c.Image){var f=document.createElement("div");f.classList.add("InfoCard-image-container"),b.card.insertBefore(f,d);var g=document.createElement("img");g.classList.add("InfoCard-image"),g.src=c.Image,g.style.width=c.ImageWidth,g.style.height=c.ImageHeight,f.appendChild(g)}if(c.Entity){var h=document.createElement("p");h.classList.add("InfoCard-entity"),h.innerHTML=c.Entity,d.appendChild(h)}var i=document.createElement("p");if(i.innerHTML=c.Abstract,i.classList.add("InfoCard-description"),d.appendChild(i),c.hasOwnProperty("Results")&&c.Results.length>0){var j=document.createElement("div");j.classList.add("InfoCard-links"),d.appendChild(j),c.Results.forEach(function(a){var b=document.createElement("a");b.href=a.FirstURL,j.appendChild(b);var c=document.createElement("img");c.src=a.Icon.URL,c.classList.add("InfoCard-link-icon"),b.appendChild(c);var d=document.createElement("span");d.innerHTML=a.Text,b.appendChild(d)})}if((c.Infobox||""!=c.Infobox)&&c.Infobox.hasOwnProperty("content")){var k=document.createElement("ul");k.classList.add("InfoCard-list"),b.card.appendChild(k),c.Infobox.content.forEach(function(a){var b=document.createElement("li");k.appendChild(b);var c=document.createElement("label");c.innerHTML=a.label,b.appendChild(c);var d=document.createElement("span");d.innerHTML=a.value,b.appendChild(d)})}break;case"D":if(!c.hasOwnProperty("RelatedTopics")&&""==c.RelatedTopics)return void b.onEmptyCallback();b.hasTabs=!0;var l=document.createElement("ul");l.classList.add("InfoCard-tabs"),b.applyDomOptions("tabs",l),d.appendChild(l),b.enableHorizontalScrolling(l);var m=document.createElement("li");m.innerHTML="Top",m.dataset.id="top",l.appendChild(m);var n=document.createElement("ul");n.className="InfoCard-category InfoCard-tab-content",n.dataset.id="top",d.appendChild(n),b.enableHorizontalScrolling(n),c.RelatedTopics.forEach(function(a){if(a.hasOwnProperty("Topics")){var c=document.createElement("li");c.innerHTML=a.Name,c.dataset.id=a.Name,l.appendChild(c);var e=document.createElement("sup");e.innerHTML=a.Topics.length,c.appendChild(e);var f=document.createElement("ul");f.className="InfoCard-category InfoCard-tab-content",f.dataset.id=a.Name,d.appendChild(f),b.enableHorizontalScrolling(f),a.Topics.forEach(function(a){b.parseTopic(a,f)})}else b.parseTopic(a,n)});var o=document.createElement("sup");o.innerHTML=n.querySelectorAll("li").length,m.appendChild(o);break;case"C":if(!c.hasOwnProperty("RelatedTopics")&&""==c.RelatedTopics)return void b.onEmptyCallback();var n=document.createElement("ul");n.className="InfoCard-category",d.appendChild(n),b.enableHorizontalScrolling(n),c.RelatedTopics.forEach(function(a){b.parseTopic(a,n)});break;case"E":if(""==c.Answer)return void b.onEmptyCallback();var p=document.createElement("p");switch(p.innerHTML=c.Answer,d.appendChild(p),c.AnswerType){case"calc":p.querySelector("style")&&p.querySelector("style").remove(),p.querySelector("script")&&p.querySelector("script").remove(),p.innerHTML=p.textContent;break;case"color_code":p.querySelector(".colorcodesbox").className="InfoCard-color-display",p.querySelector("br").remove(),p.innerHTML=p.innerHTML.replace(/hsl\(/g," · hsl("),p.innerHTML=p.innerHTML.replace(/ \· /g,"<br/>").replace("] ["," · ").replace("]","").replace("[","")}break;case"N":return void a.onError(1);default:return void a.onError(1)}b.hasTabs&&b.initTabs(),a.onLoad&&a.onLoad(b.card)},function(){a.onError(0)})},this.initTabs=function(){for(var a=b.container.querySelectorAll(".InfoCard-tab-content"),c=b.container.querySelectorAll(".InfoCard-tabs > li"),d=0,e=a.length;e>d;d++)a[d].style.display="none";b.container.querySelector(".InfoCard-tab-content[data-id='top']").style.display="block",b.container.querySelector(".InfoCard-tabs > li[data-id='top']").classList.add("InfoCard-selected");for(var d=0,e=c.length;e>d;d++)c[d].addEventListener("click",function(){for(var d=0,e=c.length;e>d;d++)c[d].classList.remove("InfoCard-selected");this.classList.add("InfoCard-selected");for(var d=0,e=a.length;e>d;d++)a[d].style.display="none";b.container.querySelector(".InfoCard-tab-content[data-id='"+this.dataset.id+"']").style.display="block"},!1)},this.destroy=function(){b.container.innerHTML=""},this.createCard()}