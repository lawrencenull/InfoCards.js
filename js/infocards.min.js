/********** Infocards.js by Tim Nguyen ***********/
/****** http://github.com/nt1m/InfoCards.js ******/
function InfoCard(g){var c=this;if(g&&g.query)this.query=g.query;else throw new SyntaxError("[InfoCard] Missing query parameter");if(g.container)this.container=g.container;else throw new SyntaxError("[InfoCard] Missing container parameter");this.apiURL="http://api.duckduckgo.com/?q="+encodeURIComponent(this.query)+"&format=json";this.getJSONData=function(b,c){var a=this.apiURL,d="jsonp_callback_"+Math.round(1E5*Math.random());window[d]=function(a){delete window[d];document.body.removeChild(f);b(a)};
var f=document.createElement("script");f.src=a+(0<=a.indexOf("?")?"&":"?")+"callback="+d;document.body.appendChild(f);f.onerror=function(){c()}};this.hasTabs=!1;this.parseTopic=function(b,c){if(!b.hasOwnProperty("Topics")){var a=document.createElement("li");c.appendChild(a);var d=document.createElement("h2");d.innerHTML=decodeURIComponent(b.FirstURL.replace("https://duckduckgo.com/","").replace(/_/g," "));a.appendChild(d);b.hasOwnProperty("Icon")&&""!=b.Icon.URL&&(d=document.createElement("img"),
d.src=b.Icon.URL,a.appendChild(d));d=document.createElement("p");d.innerHTML=b.Result;a.appendChild(d);a=d.querySelector("a");d.removeChild(a)}};this.createCard=function(){c.getJSONData(function(b){c.container.classList.add("InfoCard-container");if(""!=b.Heading){c.card=document.createElement("div");c.container.appendChild(c.card);c.card.classList.add("InfoCard-card");var e=document.createElement("div");e.classList.add("InfoCard-text");c.card.appendChild(e);var a=document.createElement("h1");e.appendChild(a);
a.classList.add("InfoCard-title");a.innerHTML=b.Heading;""!==b.Type&&c.card.classList.add("InfoCard-type-"+b.Type.toLowerCase());switch(b.Type){case "A":if(b.Image||""!=b.Image){a=document.createElement("div");a.classList.add("InfoCard-image-container");c.card.insertBefore(a,e);var d=document.createElement("img");d.classList.add("InfoCard-image");d.src=b.Image;d.style.width=b.ImageWidth;d.style.height=b.ImageHeight;a.appendChild(d)}b.Entity&&(a=document.createElement("p"),a.classList.add("InfoCard-entity"),
a.innerHTML=b.Entity,e.appendChild(a));a=document.createElement("p");a.innerHTML=b.Abstract;a.classList.add("InfoCard-description");e.appendChild(a);if(b.hasOwnProperty("Results")&&0<b.Results.length){var f=document.createElement("div");f.classList.add("InfoCard-links");e.appendChild(f);b.Results.forEach(function(a){var b=document.createElement("a");b.href=a.FirstURL;f.appendChild(b);var c=document.createElement("img");c.src=a.Icon.URL;c.classList.add("InfoCard-link-icon");b.appendChild(c);c=document.createElement("span");
c.innerHTML=a.Text;b.appendChild(c)})}if((b.Infobox||""!=b.Infobox)&&b.Infobox.hasOwnProperty("content")){var l=document.createElement("ul");l.classList.add("InfoCard-list");c.card.appendChild(l);b.Infobox.content.forEach(function(a){var b=document.createElement("li");l.appendChild(b);var c=document.createElement("label");c.innerHTML=a.label;b.appendChild(c);c=document.createElement("span");c.innerHTML=a.value;b.appendChild(c)})}break;case "D":if(b.hasOwnProperty("RelatedTopics")&&""!=b.RelatedTopics){c.hasTabs=
!0;var k=document.createElement("ul");k.classList.add("InfoCard-tabs");e.appendChild(k);a=document.createElement("li");a.innerHTML="Top";a.dataset.id="top";k.appendChild(a);var h=document.createElement("ul");h.className="InfoCard-category InfoCard-tab-content";h.dataset.id="top";e.appendChild(h);b.RelatedTopics.forEach(function(a){if(a.hasOwnProperty("Topics")){var b=document.createElement("li");b.innerHTML=a.Name;b.dataset.id=a.Name;k.appendChild(b);var d=document.createElement("sup");d.innerHTML=
a.Topics.length;b.appendChild(d);var f=document.createElement("ul");f.className="InfoCard-category InfoCard-tab-content";f.dataset.id=a.Name;e.appendChild(f);a.Topics.forEach(function(a){c.parseTopic(a,f)})}else c.parseTopic(a,h)});b=document.createElement("sup");b.innerHTML=h.querySelectorAll("li").length;a.appendChild(b)}break;case "C":b.hasOwnProperty("RelatedTopics")&&""!=b.RelatedTopics&&(h=document.createElement("ul"),h.classList.add("InfoCard-category"),e.appendChild(h),b.RelatedTopics.forEach(function(a){c.parseTopic(a,
h)}));break;case "N":break;case "E":""!=b.Answer&&(a=document.createElement("p"),a.innerHTML=b.Answer,e.appendChild(a),a.querySelector("style")&&a.querySelector("style").remove(),a.querySelector("script")&&a.querySelector("script").remove(),a.innerHTML=a.textContent);break;default:return}c.hasTabs&&c.initTabs();g.onLoad&&g.onLoad().bind(c.card)}else g.hasOwnProperty("onEmpty")&&g.onEmpty().bind(c.container)})};this.initTabs=function(){for(var b=c.container.querySelectorAll(".InfoCard-tab-content"),
e=c.container.querySelectorAll(".InfoCard-tabs > li"),a=0,d=b.length;a<d;a++)b[a].style.display="none";c.container.querySelector(".InfoCard-tab-content[data-id='top']").style.display="block";c.container.querySelector(".InfoCard-tabs > li[data-id='top']").classList.add("InfoCard-selected");a=0;for(d=e.length;a<d;a++)e[a].addEventListener("click",function(){for(var a=0,d=e.length;a<d;a++)e[a].classList.remove("InfoCard-selected");this.classList.add("InfoCard-selected");a=0;for(d=b.length;a<d;a++)b[a].style.display=
"none";c.container.querySelector(".InfoCard-tab-content[data-id='"+this.dataset.id+"']").style.display="block"},!1)};this.destroy=function(){c.container.innerHTML=""};this.createCard()};
